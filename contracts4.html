<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Pro Painting Plus - Professional Estimate</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="All Pro Painting">
<link rel="apple-touch-icon" href="original333.png">
<style>
:root { 
    --allpro-blue: #002D62; 
    --border-heavy: 2px solid var(--allpro-blue); 
}

/* BODY */
body { 
    font-family: "Segoe UI", Arial, sans-serif;
    background-color: #555; 
    margin: 0; padding: 0; padding-bottom: 120px; 
}

/* PAGE SETUP */
.contract-page { 
    background: white; 
    width: 8.5in;
    margin: 20px auto; 
    padding: 0.4in; 
    box-shadow: 0 0 15px rgba(0,0,0,0.5); 
    box-sizing: border-box; 
    position: relative; 
}

/* HEADER */
.top-header { 
    display: grid; 
    grid-template-columns: 1fr 2fr 1fr; 
    border-bottom: var(--border-heavy); 
    padding-bottom: 8px; 
    margin-bottom: 8px;
    align-items: center;
}

.header-left { display: flex; flex-direction: column; gap: 5px; align-items: flex-start; }
.cert-img-osha { height: 35px; width: auto; }
.cert-img-epa { height: 40px; width: auto; }

.header-center { text-align: center; color: var(--allpro-blue); }
.header-center h1 { margin: 0; font-size: 24px; letter-spacing: 1px; text-transform: uppercase; }
.header-center p { margin: 2px 0; font-size: 11px; font-weight: 600; }
.header-center h4 { margin: 8px 0 0 0; font-size: 16px; text-decoration: underline; }

.header-right { color: var(--allpro-blue); font-weight: bold; font-size: 11px; line-height: 1.1; text-align: right; }

/* INFO GRID - FIXED RIGHT BORDER */
.info-grid { 
    display: grid; 
    grid-template-columns: repeat(4, 1fr); 
    border-top: var(--border-heavy);
    border-left: var(--border-heavy);
    margin-bottom: 10px; 
}
.info-cell { 
    border-right: var(--border-heavy); 
    border-bottom: var(--border-heavy); 
    padding: 2px 5px; 
}
.label { font-size: 8px; font-weight: 800; text-transform: uppercase; display: block; color: var(--allpro-blue); }
input { border: none; font-family: inherit; font-size: 12px; height: 18px; width: 100%; outline: none; background: transparent; }

/* CALENDAR INPUT STYLING */
input[type="date"] { font-size: 11px; color: #333; }

/* TABLE FIXES */
table { width: 100%; border-collapse: collapse; border: var(--border-heavy); margin-bottom: 10px; table-layout: fixed; }
th { border: 1px solid var(--allpro-blue); background: #f0f4f8; padding: 4px; font-size: 10px; color: var(--allpro-blue); }
td { border: 1px solid var(--allpro-blue); padding: 0; vertical-align: top; }

tr { page-break-inside: avoid !important; break-inside: avoid !important; }

textarea { 
    width: 100%; border: none; font-family: inherit; font-size: 12px; resize: none; 
    background: transparent; padding: 4px; box-sizing: border-box; overflow: hidden; 
    min-height: 24px; line-height: 1.3; display: block;
}

.print-text { display: none; white-space: pre-wrap; word-wrap: break-word; font-size: 12px; padding: 4px; line-height: 1.3; }

/* SIGNATURE BOX */
#sig-canvas { background: #f9f9f9; cursor: crosshair; width: 100%; height: 70px; border-bottom: 1px solid #000; margin-top: 5px; }
.sig-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 5px; }

/* PRINT SETTINGS */
@media print {
    @page { size: Letter; margin: 0.5in; }
    body { background: white; padding: 0; }
    .app-footer, .no-print, input[type="file"], .btn-red, .sig-btn { display: none !important; }
    .contract-page { margin: 0; width: 100%; box-shadow: none; border: none !important; padding: 0.1in; }
    .force-break { break-before: page; page-break-before: always; }
    textarea { display: none !important; }
    .print-text { display: block !important; }
}

.app-footer { position: fixed; bottom: 0; width: 100%; background: #111; padding: 20px; display: flex; justify-content: center; gap: 20px; z-index: 1000; }
.btn { padding: 15px 30px; font-weight: bold; cursor: pointer; border: 2px solid white; text-transform: uppercase; border-radius: 4px; }
.btn-blue { background: var(--allpro-blue); color: white; }
.btn-green { background: #27ae60; color: white; }
.sig-btn { background: #eee; border: 1px solid #ccc; font-size: 9px; padding: 2px 5px; cursor: pointer; color: #666; border-radius: 3px; }
</style>
</head>

<body>

<div class="contract-page">
    <div class="top-header">
        <div class="header-left">
            <img src="lead-safe-certified-firm.png" class="cert-img-epa">
            <img src="original333.png" class="cert-img-osha">
        </div>
        
        <div class="header-center">
            <h1>ALL PRO PAINTING PLUS</h1>
            <p>(518) 701-0308 | www.allpropaintingplus.com</p>
            <h4>RESIDENTIAL PAINTING CONTRACT</h4>
        </div>

        <div class="header-right">
            Quality<br>Service<br>Reliability<br>
            <div style="margin-top: 8px;">
                <span class="label" style="text-align: right;">Date</span>
                <input type="date" id="docDate" style="text-align:right;">
            </div>
        </div>
    </div>

    <div style="border: 3px double var(--allpro-blue); text-align: center; padding: 4px; margin-bottom: 10px; font-weight: bold; color: var(--allpro-blue); font-size: 10px;">
        LICENSED / CERTIFIED / FULLY INSURED / 40 YEARS EXPERIENCE
    </div>

    <div class="info-grid">
        <div class="info-cell" style="grid-column: span 3;"><span class="label">Customer Name</span><input type="text"></div>
        <div class="info-cell"><span class="label">Phone</span><input type="text"></div>
        <div class="info-cell" style="grid-column: span 4;"><span class="label">Project Street Address</span><input type="text"></div>
        <div class="info-cell" style="grid-column: span 2;"><span class="label">City</span><input type="text"></div>
        <div class="info-cell"><span class="label">State</span><input type="text" value="NY"></div>
        <div class="info-cell"><span class="label">Zip</span><input type="text"></div>
        <div class="info-cell" style="grid-column: span 2;"><span class="label">Email</span><input type="text"></div>
        <div class="info-cell"><span class="label">Start Date</span><input type="date"></div>
        <div class="info-cell"><span class="label">Est. Finish</span><input type="date"></div>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width:20%;">Area</th>
                <th style="width:50%;">Work Description</th>
                <th style="width:15%;">Materials</th>
                <th style="width:15%;">Labor</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>

    <div style="display:grid; grid-template-columns:1.5fr 1fr; gap:15px; margin-top:10px;">
        <div style="border:var(--border-heavy); padding:8px;">
            <span class="label" style="font-size:7px; line-height: 1.1;">Customer Signature and Acceptance: Stipulates authority to enter into Contract and agreement to Payment In Full On Day Of Completion.</span>
            <canvas id="sig-canvas"></canvas>
            <div class="sig-controls">
                <span style="font-size: 10px; color: var(--allpro-blue); font-weight: bold;">Signature</span>
                <button class="sig-btn no-print" onclick="clearSig()">Clear Signature</button>
                <span style="font-size: 10px; color: var(--allpro-blue); font-weight: bold;">Date</span>
            </div>
        </div>
        <div style="border:var(--border-heavy); padding:10px; text-align:right; color:var(--allpro-blue);">
            <div style="font-weight: bold; font-size: 12px;">SUB TOTAL: <span id="lDisp">$0.00</span></div>
            <div style="font-size:10px; margin-top: 3px;">NY Sales Tax: <input type="number" id="tax" style="width:60px; border-bottom: 1px solid var(--allpro-blue); text-align: right;" onchange="calcTotal()"></div>
            <div style="font-size:16px; font-weight:bold; border-top:2px solid var(--allpro-blue); margin-top:5px; padding-top:5px;">
                TOTAL DUE: <span id="gDisp">$0.00</span>
            </div>
            <p style="font-size:10px; margin-top:10px; font-weight: bold;">Contractors Signature</p>
        </div>
    </div>
</div>

<div class="contract-page force-break">
    <h3 style="color:#002D62; border-bottom:2px solid #002D62; padding-bottom:4px; margin-top: 0; font-size: 14px;">TERMS & DISCLOSURES</h3>
    <div style="font-size:10px; line-height:1.3; text-align: justify; color: #333;">
        <p><strong>LEGAL DISCLOSURES:</strong> Pursuant to NYS GBL, you have a right to cancel this contract within three business days. Notice of cancellation must be in writing. In addition to any right otherwise to revoke an offer, the owner may cancel the home improvement contract until midnight of the third business day after the day on which the owner has signed an agreement or offer to purchase relating to such contract. [cite: 234, 235]</p>
        <p><strong>MECHANIC'S LIEN:</strong> Any contractor, subcontractor, or materialman who provides home improvement goods or services pursuant to your home improvement contract and who is not paid may have a valid legal claim against your property known as a mechanic's lien. [cite: 236]</p>
        <p><strong>UNFORESEEN CONDITIONS:</strong> Consumer agrees to pay additional reasonable fees for unforeseen work discovered after project commencement. [cite: 237]</p>
        <p><strong>NON-DISPARAGEMENT:</strong> You agree that you will not (nor will you cause or cooperate with others to) publicly criticize, ridicule, disparage or defame APP+, the company or its products, services, policies, directors, officers, employees, with or through any written or oral statement or image. [cite: 238]</p>
        <p><strong>PAYMENT:</strong> Payment is due in full on the day of completion via local check, cash, or certified bank check. No credit cards. Your payment signifies that you the consumer are 100% satisfied and that the job is completed to your satisfaction. [cite: 239, 240]</p>
    </div>
</div>

<div id="photoPagesContainer"></div>

<div class="app-footer">
    <button class="btn btn-blue" onclick="addRow()">+ Add Line</button>
    <button class="btn btn-blue" onclick="addNewPhoto()">+ Add Photo</button>
    <button class="btn btn-green" onclick="window.print()">Generate PDF</button>
</div>

<script>
// Auto-fill today's date in calendar format
document.getElementById('docDate').valueAsDate = new Date();

function addRow(){ 
    const tr=document.createElement('tr'); 
    tr.innerHTML=`
        <td><textarea oninput="autoExpand(this)"></textarea><div class="print-text"></div></td>
        <td><textarea oninput="autoExpand(this)"></textarea><div class="print-text"></div></td>
        <td><input type="text" onchange="calcTotal()"></td>
        <td><input type="number" class="lab" onchange="calcTotal()"></td>`; 
    document.getElementById('rows').appendChild(tr); 
}
for(let i=0;i<1;i++) addRow();

function autoExpand(el){ 
    el.style.height="auto"; 
    el.style.height=el.scrollHeight+"px"; 
    const printDiv = el.parentElement.querySelector('.print-text');
    if(printDiv) printDiv.innerText = el.value;
}

function calcTotal(){
    let l=0;
    document.querySelectorAll('.lab').forEach(i=>l+=Number(i.value)||0);
    let t=Number(document.getElementById('tax').value)||0;
    lDisp.innerText='$'+l.toFixed(2); gDisp.innerText='$'+(l+t).toFixed(2);
}

// Photo Logic and Signature Logic remains same as previous functional version...
let photoTotal=0;
function addNewPhoto(){
    photoTotal++;
    let container = document.getElementById('photoPagesContainer');
    let pages = container.querySelectorAll('.photo-page');
    let last = pages[pages.length-1];
    if(!last || last.querySelector('.photo-grid').querySelectorAll('.photo-slot').length >= 4){
        last = document.createElement('div');
        last.className = 'contract-page photo-page force-break';
        last.innerHTML = `<h2 style="border-bottom:var(--border-heavy);color:var(--allpro-blue); margin-top:0; font-size: 16px;">PROJECT PHOTO LOG</h2><div class="photo-grid"></div>`;
        container.appendChild(last);
    }
    const slot = document.createElement('div');
    slot.className = 'photo-slot';
    const id = 'img-' + photoTotal;
    slot.innerHTML = `
        <span class="label">Description</span>
        <textarea oninput="autoExpand(this)"></textarea><div class="print-text"></div>
        <input type="file" accept="image/*" onchange="pv(this,'${id}')" class="no-print">
        <img id="${id}" class="preview-img">
        <button class="btn-red" onclick="this.parentElement.remove()">Remove</button>`;
    last.querySelector('.photo-grid').appendChild(slot);
}

function pv(input,id){ 
    if(input.files&&input.files[0]){ 
        let r=new FileReader(); 
        r.onload=e=>{ let img=document.getElementById(id); img.src=e.target.result; img.style.display='block'; }; 
        r.readAsDataURL(input.files[0]); 
    } 
}

const canvas=document.getElementById('sig-canvas'); 
const ctx=canvas.getContext('2d');
function clearSig() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
function resizeCanvas(){ 
    const ratio=window.devicePixelRatio||1; 
    canvas.width=canvas.offsetWidth*ratio; canvas.height=canvas.offsetHeight*ratio; 
    ctx.scale(ratio,ratio); ctx.lineWidth=2; ctx.strokeStyle="#000";
}
resizeCanvas(); 
window.addEventListener('resize',resizeCanvas);
let drawing=false;
function pos(e){ 
    const r=canvas.getBoundingClientRect(); 
    return{ x:(e.touches?e.touches[0].clientX:e.clientX)-r.left, y:(e.touches?e.touches[0].clientY:e.clientY)-r.top }; 
}
canvas.addEventListener('mousedown',e=>{ drawing=true; ctx.beginPath(); let p=pos(e); ctx.moveTo(p.x,p.y); });
canvas.addEventListener('mousemove',e=>{ if(!drawing)return; let p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); });
window.addEventListener('mouseup',()=>drawing=false);
canvas.addEventListener('touchstart',e=>{ drawing=true; ctx.beginPath(); let p=pos(e); ctx.moveTo(p.x,p.y); },{passive:false});
canvas.addEventListener('touchmove',e=>{ if(!drawing)return; e.preventDefault(); let p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); },{passive:false});
</script>
</body>
</html>
